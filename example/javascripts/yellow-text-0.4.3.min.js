/*!*
* Yellow Text
* =========================================
* This plugin is created to make text editing
* more fun and to make it easy for the editor.
*
* Version: 0.4.3
* Author: Stefan Vermaas
* URL: www.stefanvermaas.nl
*
*/(function(e){"use strict";var t=function(){},n={initialize:function(r,i){n.el=r;n.settings=e.extend({width:"100%",height:"300px",containerClass:"js-editor-container",buttonsClass:"js-editor-buttons",iFrameClass:"js-editor-iframe",cleanOnSubmit:!0,defaultFont:"Helvetica Neue, Helvetica, arial, sans-serief",defaultFontSize:"1em",defaultFontColor:"#000000",defaultActions:["bold","underline","italic","strikethrough","align-left","align-center","align-right","unordered-list","ordered-list","link","image"],isContentChanged:t,setImage:t},i);n.render();n.setContentToEditor(n.getContentFromTextarea());n.events()},setContentToEditor:function(t){e(n.editor).contents().find("body").append(t);return t},setContentToTextarea:function(t){e(n.el).val(t);return t},getContentFromTextarea:function(){return e(n.el).val()},getContentFromEditor:function(){return e(n.editor).contents().find("body").html()},render:function(){e(n.el).hide();n.container=e("<div />").addClass(n.settings.containerClass).css({"float":"left",width:n.settings.width,border:"1px solid #ccc"});e(n.el).after(n.container);n.editor=e("<iframe />").addClass(n.settings.iFrameClass).css({"float":"left",width:n.settings.width,height:n.settings.height,border:"0",overflow:"hidden"}).appendTo(n.container).get(0);n.editor.contentWindow.document.open();n.editor.contentWindow.document.close();n.editor.contentWindow.document.designMode="on";e(n.editor).contents().find("body").css({"word-wrap":"break-word","font-family":n.settings.defaultFont,"font-size":n.settings.defaultFontSize,color:n.settings.defaultFontColor});var t='<style type="text/css">body{padding:2%;}p{margin:0;}</style>';e(n.editor).contents().find("head").append(t);n.buttons=e("<div />").addClass(n.settings.buttonsClass).css({"float":"left",width:n.settings.width}).prependTo(n.container);n.createButtons()},createButtons:function(){for(var t=0;t<n.settings.defaultActions.length;t++){var r;switch(n.settings.defaultActions[t]){case"bold":r={content:"b",command:"bold"};break;case"underline":r={content:"u",command:"underline"};break;case"italic":r={content:"i",command:"italic"};break;case"strikethrough":r={content:"s",command:"strikethrough"};break;case"align-left":r={content:"left",command:"JustifyLeft"};break;case"align-center":r={content:"center",command:"JustifyCenter"};break;case"align-right":r={content:"right",command:"JustifyRight"};break;case"unordered-list":r={content:"ul",command:"InsertUnorderedList"};break;case"ordered-list":r={content:"ol",command:"InsertOrderedList"};break;case"image":r={content:"img",command:"image"};break;case"link":r={content:"link",command:"link"};break;default:r={content:"",command:""}}e("<a />").addClass(r.command).text(r.content).data("command",r.command).appendTo(n.buttons)}},events:function(){e("."+n.settings.buttonsClass+" a").on("click",function(t){var r=e(this).data("command");n.buttonClicked(t,r)});e(n.editor).contents().find("body").on("keydown",function(e){(e.ctrlKey||e.metaKey)&&n.shortkey(e,this)});e(n.editor).contents().find("body").on("keyup",function(){var t=e(n.editor).contents().find("body").html()!==e(n.el).text()?!0:!1;n.settings.isContentChanged(t)});e(n.el).parents("form").on("submit",function(){n.cleanTheCode();n.setContentToTextarea(n.getContentFromEditor());return!1})},buttonClicked:function(e,t){n.editor.contentWindow.focus();n.runCMD(t);n.editor.contentWindow.focus()},shortkey:function(e){var t=e.which;if(t===66||t===73||t===85){n.editor.contentWindow.focus();switch(t){case 66:n.runCMD("bold");break;case 73:n.runCMD("italic");break;case 85:n.runCMD("underline")}n.editor.contentWindow.focus()}},runCMD:function(e){if(e==="image"){var t;typeof n.settings.setImage=="function"&&(t=n.settings.setImage.call());var r=typeof t!="undefined"&&t.length>0?t:prompt("URL (example: http://www.google.com): ");return n.editor.contentWindow.document.execCommand("InsertImage",!1,r)}if(e==="link"){var i=prompt("URL (example: http://www.google.com): ");return n.editor.contentWindow.document.execCommand("CreateLink",!1,i)}return n.editor.contentWindow.document.execCommand(e)},cleanTheCode:function(){e(n.editor).contents().find("div").each(function(){e(this).replaceWith("<p>"+e(this).html()+"</p>")});e(n.editor).contents().find("body").find("br").each(function(){e(this).removeAttr("class").unwrap()});e(n.editor).contents().find("body").find("ul").each(function(){e(this).removeAttr("class").unwrap()});e(n.editor).contents().find("body").find("ol").each(function(){e(this).removeAttr("class").unwrap()})}};e.fn.texteditor=function(t){return this.each(function(){if(n[t])return n[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t=="object"||!t)return n.initialize(this,t);e.error("Method "+t+" does not exist on jQuery.texteditor")})}})(jQuery);