/*!*
*	Yellow Text
*	=========================================
*	This plugin is created to make text editing
*	more fun and to make it easy for the editor.
*
*	Version: 0.2
*	Author: Stefan Vermaas
*	URL: www.stefanvermaas.nl
*
*/(function(e){var t={init:function(t,n){this.el=t;this.settings=e.extend({width:"100%",height:"300px",containerClass:"js-editor-container",buttonsClass:"js-editor-buttons",iFrameClass:"js-editor-iframe",formID:"js-editor-form",cleanOnSubmit:!0,defaultFont:"Helvetica Neue, Helvetica, arial, sans-serief",defaultFontSize:"1em",defaultFontColor:"#000000",defaultActions:"bold, underline, italic, strikethrough, align-left, align-center, align-right, unorderd-list, ordered-list, link, image",isContentChanged:function(){}},n);this.render();this.setContent();this.events()},render:function(){this.createTextEditor();this.createButtons()},createTextEditor:function(){e(this.el).hide();this.container=e("<div />").addClass(this.settings.containerClass).css({"float":"left",width:this.settings.width,border:"1px solid #ccc"});e(this.el).after(this.container);this.editor=e("<iframe />").addClass(this.settings.iFrameClass).css({"float":"left",width:this.settings.width,height:this.settings.height,border:"0",overflow:"hidden"}).appendTo(this.container).get(0);this.editor.contentWindow.document.open();this.editor.contentWindow.document.close();this.editor.contentWindow.document.designMode="on";e(this.editor).contents().find("body").css({"word-wrap":"break-word","font-family":this.settings.defaultFont,"font-size":this.settings.defaultFontSize,color:this.settings.defaultFontColor});var t='<style type="text/css">body{padding: 2%;} p { margin: 0; }</style>';e(this.editor).contents().find("head").append(t);this.buttons=e("<div />").addClass(this.settings.buttonsClass).css({"float":"left",width:this.settings.width}).prependTo(this.container)},setContent:function(){var t=e(this.el).text();e(this.editor).contents().find("body").append(t)},createButtons:function(){var t=this.settings.defaultActions.split(/, ?/);for(i=0;i<t.length;i++){var n;switch(t[i]){case"bold":n={content:"b",command:"bold"};break;case"underline":n={content:"u",command:"underline"};break;case"italic":n={content:"i",command:"italic"};break;case"strikethrough":n={content:"s",command:"strikethrough"};break;case"align-left":n={content:"left",command:"JustifyLeft"};break;case"align-center":n={content:"center",command:"JustifyCenter"};break;case"align-right":n={content:"right",command:"JustifyRight"};break;case"unorderd-list":n={content:"ul",command:"InsertUnorderedList"};break;case"ordered-list":n={content:"ol",command:"InsertOrderedList"};break;case"image":n={content:"img",command:"image"};break;case"link":n={content:"link",command:"link"};break;default:n={content:"",command:""}}e("<a />").addClass(n.command).text(n.content).attr("data-command",n.command).appendTo(this.buttons)}},events:function(){e("."+t.settings.buttonsClass+" a").on("click",function(e){t.buttonClicked(e,this)});e(t.editor).contents().find("body").on("keydown",function(e){(e.ctrlKey||e.metaKey)&&t.shortkey(e,this)});e(t.editor).contents().find("body").on("keyup",function(n){var r=e(t.editor).contents().find("body").html()!==e(t.el).text()?!0:!1;t.isContentChanged(r)});e(t.settings.formID).on("submit",function(e){t.cleanTheCode();t.putContentBack()})},buttonClicked:function(t,n){var r=e(n).attr("data-command");this.editor.contentWindow.focus();this.runCMD(r);this.editor.contentWindow.focus()},shortkey:function(e){var t;this.editor.contentWindow.focus();e.which===66?t="bold":e.which===73?t="italic":e.which===85?t="underline":t="";this.runCMD(t);this.editor.contentWindow.focus()},runCMD:function(e){if(e==="image"){var t=prompt("URL (example: http://www.google.com): ");return this.editor.contentWindow.document.execCommand("InsertImage",!1,t)}if(e==="link"){var n=prompt("URL (example: http://www.google.com): ");return this.editor.contentWindow.document.execCommand("CreateLink",!1,n)}return this.editor.contentWindow.document.execCommand(e)},cleanTheCode:function(){var t=e(this.editor).contents().find("body");t.find("div").each(function(){var t=e(this).attr("style")?!0:!1;e(this).parent("p").not("p")&&(t?e(this).wrap('<p style="'+e(this).attr("style")+'"></p>'):e(this).wrap("<p></p>"));e(this).contents().unwrap()});t.find("br").unwrap();var n=t.contents()[0];t.find(n).not("p")&&t.find(n).wrap("p")},putContentBack:function(){var t=e(this.editor).contents().find("body").html();this.el.html(t)}};e.fn.texteditor=function(n){return this.each(function(){if(t[n])return t[n].apply(this,Array.prototype.slice.call(arguments,1));if(typeof n=="object"||!n)return t.init(this,n);e.error("Method "+n+" does not exist on jQuery.texteditor")})}})(jQuery);